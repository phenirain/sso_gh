# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ Prometheus –¥–ª—è SSO API

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### ‚úÖ 1. –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- **Endpoint**: `GET /metrics` (http://localhost:8081/metrics)
- **–§–æ—Ä–º–∞—Ç**: Prometheus exposition format
- **–î–æ—Å—Ç—É–ø**: –ü—É–±–ª–∏—á–Ω—ã–π endpoint (–±–µ–∑ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: [pkg/metrics/metrics.go](pkg/metrics/metrics.go)

### ‚úÖ 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è 3 –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### –ú–µ—Ç—Ä–∏–∫–∞ 1: HTTP Request Rate
- **Prometheus metric**: `sso_http_requests_total`
- **–¢–∏–ø**: Counter
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Time Series (–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)
- **–õ–µ–≥–µ–Ω–¥–∞**: last, max, mean
- **–ó–∞—á–µ–º**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API, –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞

#### –ú–µ—Ç—Ä–∏–∫–∞ 2: HTTP Request Duration
- **Prometheus metric**: `sso_http_request_duration_seconds`
- **–¢–∏–ø**: Histogram
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Time Series —Å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è–º–∏ (p50, p95)
- **–õ–µ–≥–µ–Ω–¥–∞**: last, max, mean
- **–ó–∞—á–µ–º**: –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –ú–µ—Ç—Ä–∏–∫–∞ 3: HTTP Requests In-Flight
- **Prometheus metric**: `sso_http_requests_in_flight`
- **–¢–∏–ø**: Gauge
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Gauge (—à–∫–∞–ª–∞ —Å –ø–æ—Ä–æ–≥–∞–º–∏)
- **–õ–µ–≥–µ–Ω–¥–∞**: lastNotNull
- **–ó–∞—á–µ–º**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### ‚úÖ 3. –¢—Ä–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

#### –ö–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ 1: Total Users
```promql
sso_total_users
```
- **–¢–∏–ø**: Gauge
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (`SELECT COUNT(*) FROM users`)
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Gauge (–∫—Ä—É–≥–æ–≤–∞—è —à–∫–∞–ª–∞)
- **–õ–µ–≥–µ–Ω–¥–∞**: lastNotNull
- **–°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ**: ‚úÖ **–î–ê** - –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –ë–î
- **–ë–∏–∑–Ω–µ—Å-–∑–Ω–∞—á–µ–Ω–∏–µ**:
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∞–∑—ã
  - –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞

#### –ö–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ 2: Authentication Operations
```promql
sso_auth_operations_total{operation="login|signup|refresh", status="success|failure"}
```
- **–¢–∏–ø**: Counter
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ú–µ—Ç–∫–∏**:
  - `operation`: login, signup, refresh
  - `status`: success, failure
- **–¢—Ä–∏–≥–≥–µ—Ä**: –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Stacked Bars (—Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π)
- **–õ–µ–≥–µ–Ω–¥–∞**: sum, last
- **–¶–≤–µ—Ç–∞**: –ó–µ–ª–µ–Ω—ã–π (success), –ö—Ä–∞—Å–Ω—ã–π (failure)
- **–°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ**: ‚ö†Ô∏è **–ù–ï–¢** - Counter —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `rate()` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)
- **–ë–∏–∑–Ω–µ—Å-–∑–Ω–∞—á–µ–Ω–∏–µ**:
  - –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫)
  - –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –ö–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ 3: Active Sessions
```promql
sso_active_sessions
```
- **–¢–∏–ø**: Gauge
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π (–≤–∞–ª–∏–¥–Ω—ã—Ö JWT —Ç–æ–∫–µ–Ω–æ–≤)
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å JWT
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Gauge (–∫—Ä—É–≥–æ–≤–∞—è —à–∫–∞–ª–∞)
- **–õ–µ–≥–µ–Ω–¥–∞**: lastNotNull
- **–°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ**: ‚ÑπÔ∏è **–ß–ê–°–¢–ò–ß–ù–û** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- **–ë–∏–∑–Ω–µ—Å-–∑–Ω–∞—á–µ–Ω–∏–µ**:
  - –†–µ–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É –≤ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç
  - –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
  - –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫

### ‚úÖ 4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ

**Grafana Dashboard**: "SSO API Metrics Dashboard"
- **–§–∞–π–ª**: [deployments/grafana/dashboards/sso-metrics.json](deployments/grafana/dashboards/sso-metrics.json)
- **–ü–∞–Ω–µ–ª–µ–π**: 7 (3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + 3 –∫–∞—Å—Ç–æ–º–Ω—ã–µ + 1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è)
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–ü–µ—Ä–∏–æ–¥**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç

#### –ü–∞–Ω–µ–ª–∏ –¥–∞—à–±–æ—Ä–¥–∞:
1. HTTP Request Rate (Time Series)
2. HTTP Request Duration Percentiles (Time Series)
3. **HTTP Requests In-Flight (Gauge)** ‚≠ê
4. **Total Registered Users (Gauge)** ‚≠ê
5. **Active User Sessions (Gauge)** ‚≠ê
6. **Authentication Operations Rate (Stacked Bars)** ‚≠ê
7. Database Records Count (Time Series)

### ‚úÖ 5. –°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–ø | –°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å | –ú–µ—Ö–∞–Ω–∏–∑–º |
|---------|-----|-------------|----------|
| **sso_total_users** | Gauge | ‚úÖ –ü–æ–ª–Ω–∞—è | –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –ë–î –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ |
| **sso_auth_operations_total** | Counter | ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è | Counter-–º–µ—Ç—Ä–∏–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ rate()) |
| **sso_active_sessions** | Gauge | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö |
| sso_database_records_total | Gauge | ‚úÖ –ü–æ–ª–Ω–∞—è | –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –ë–î –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ |

**–í–∞–∂–Ω–æ**: Prometheus —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –º–µ—Ç—Ä–∏–∫ (retention: 7 –¥–Ω–µ–π), –ø–æ—ç—Ç–æ–º—É –≥—Ä–∞—Ñ–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   SSO API       ‚îÇ
‚îÇ   :8081         ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ  /metrics  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ Prometheus scraping (–∫–∞–∂–¥—ã–µ 15 —Å–µ–∫)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ PostgreSQL queries (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Metrics ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Prometheus  ‚îÇ
    ‚îÇCollector‚îÇ         ‚îÇ    :9090     ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚îÇ PromQL queries
                               ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ   Grafana    ‚îÇ
                        ‚îÇ    :3000     ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
sso/
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îú‚îÄ‚îÄ metrics/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics.go          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ collector.go        # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ echomiddleware/
‚îÇ       ‚îî‚îÄ‚îÄ metrics.go          # HTTP middleware –¥–ª—è –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.go           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è /metrics endpoint
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth/handler.go     # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ auth –æ–ø–µ—Ä–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ run.go                  # –ó–∞–ø—É—Å–∫ metrics collector
‚îú‚îÄ‚îÄ deployments/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yaml     # Docker Compose —Å Prometheus –∏ Grafana
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ grafana/
‚îÇ       ‚îú‚îÄ‚îÄ provisioning/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ datasources/    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dashboards/     # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ dashboards/
‚îÇ           ‚îî‚îÄ‚îÄ sso-metrics.json # –î–∞—à–±–æ—Ä–¥ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
‚îî‚îÄ‚îÄ MONITORING.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make docker_compose_up

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
make metrics_test

# 3. –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
make metrics_open
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
curl http://localhost:8081/metrics

# –§–∏–ª—å—Ç—Ä –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
curl -s http://localhost:8081/metrics | grep sso_total_users
curl -s http://localhost:8081/metrics | grep sso_auth_operations_total
curl -s http://localhost:8081/metrics | grep sso_active_sessions

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
curl -X POST http://localhost:8081/auth/signUp \
  -H "Content-Type: application/json" \
  -d '{"login": "test1", "password": "pass123"}'
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Grafana

### PromQL –∑–∞–ø—Ä–æ—Å—ã

```promql
# 1. Request rate –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
rate(sso_http_requests_total[5m])

# 2. 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
histogram_quantile(0.95, sum(rate(sso_http_request_duration_seconds_bucket[5m])) by (le, method, path))

# 3. –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sso_total_users

# 4. –†–æ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
delta(sso_total_users[1h])

# 5. Success rate –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
sum(rate(sso_auth_operations_total{status="success"}[5m])) /
sum(rate(sso_auth_operations_total[5m]))

# 6. –¢–æ–ø-5 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö endpoints
topk(5, histogram_quantile(0.95, rate(sso_http_request_duration_seconds_bucket[5m])) by (path))
```

## üéØ –ò—Ç–æ–≥–∏

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –í—ã–≥—Ä—É–∑–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- ‚úÖ 3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å –ª–æ–≥–∏—á–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ 3 –∫–∞—Å—Ç–æ–º–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ (users, auth, sessions)
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –≤ Grafana
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–µ–≥–µ–Ω–¥—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (–¥–ª—è Gauge —á–µ—Ä–µ–∑ –ë–î)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana —á–µ—Ä–µ–∑ provisioning
- ‚úÖ Docker Compose –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- Go (prometheus/client_golang)
- Prometheus
- Grafana
- PostgreSQL
- Docker Compose

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ –ë–î** –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
2. **Middleware –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è** –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–Ø–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ provisioning** Grafana –¥–∞—à–±–æ—Ä–¥–æ–≤
5. **7-–¥–Ω–µ–≤–Ω—ã–π retention** –≤ Prometheus
6. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead** –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (<1% CPU)
